
<!--

    Autor: Vin√≠cius Mancini Meneses de Miranda
    Prop√≥sito: Projeto em resposta ao case em processo seletivo da empresa Mosaico.
    
-->

<!DOCTYPE html>
<html>
	<head>
	<!-- A linha abaixo ativa os caracteres especiais -->
		<meta charset="UTF-8">
		<title>Jogo da Velha</title>

    <!-- Aqui usei a tag 'style' para trabalhar com o CSS-->
    
		<style>

    /* Defini√ß√£o dos atributos para o corpo do c√≥digo HTML */
      
    body{
		background-color: #313338;
		color: white;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		height: 100vh;
		margin: 0;
		padding: 0;
		
    }
      
	/* Essa classe cria um quadrado */
	.quadrado {
		width: 150px;
		height: 150px;
		border: 2px solid black;
		float: left;
		text-align: center;
        font-size: 105px;
		}

	/* Essa classe deixa os quadrados na mesma linha */
	.coluna {
		clear: both;
		}

	/*Esse ID personaliza o bot√£o */
	
	#botao{

		display: inline-block;
		background-color: solid rgba(245, 245, 245, 0.726);
		color: #313338;
		padding: 10px 27px;
		margin: 4px 2px;
		font-family : FreeMono, monospace;
		border: none;
        cursor:pointer;
        
	}

    #botao:hover {
      background-color:#31333896;
      transition: 0.7s;
      color:rgba(245, 245, 245, 0.726);
  }

    .quadrado:hover{
      background-color:#7e7e8036;
      transition: 0.5s;
      color:rgba(245, 245, 245, 0.726);
    }
    
      
		</style>
    
	</head>
	<body>
		<h4 id = "turno" style="font-family : FreeMono, monospace;"></h4>
    <div>
		<div class="coluna">
			<div class="quadrado" id="quadrado0"></div>
			<div class="quadrado" id="quadrado1"></div>
			<div class="quadrado" id="quadrado2"></div>
		</div>
		<div class="coluna">
			<div class="quadrado" id="quadrado3"></div>
			<div class="quadrado" id="quadrado4"></div>
			<div class="quadrado" id="quadrado5"></div>
		</div>
		<div class="coluna">
			<div class="quadrado" id="quadrado6"></div>
			<div class="quadrado" id="quadrado7"></div>
			<div class="quadrado" id="quadrado8"></div>
		</div>
    </div>
    <br>
    <br>

    <center>
    <button onclick="startGame()" style="display: none;" id="botao">Jogar Novamente</button>
    
    <br>
    <br>
    
    <div id = "Mensagem" style="font-family : FreeMono, monospace;"></div>
    </center>
    
   <!-- Aqui abri a tag 'script' para trabalhar com o javascript -->
    
		<script>

		// Tabuleiro representado por uma matriz
		var board = [];

		// Vari√°vel dos turnos
		var userTurn = true;
      
		// Essa fun√ß√£o vai atualizar o tabuleiro no HTML
		function updateBoard() {
			for (var i = 0; i < board.length; i++) {
				document.getElementById("quadrado" + (i)).innerText = board[i];
			}
		}
		
		// Essa fun√ß√£o vai procurar pelos espa√ßos vazio do tabuleiro
		function vazio() {
      
			var vazios = [];

            for(var i = 0; i < board.length; i++){

            if(board[i] == ""){
            vazios.push(i);
            }
        
            }

          return vazios;
		}
		
	  // Fun√ß√£o referente ao turno do computador
	  function computerTurn() {
		console.log(board);
      var v = vazio();
      var timeout = 1000;
	  document.getElementById("turno").innerText = "Vez do advers√°rio";
      vitoria("‚úï", v);

	  setTimeout(function(){
      IA(v);
      updateBoard();
      vitoria("ê§è", v);
	  userTurn = true;
	  
	  }, timeout);

	  // For√ßa uma verifica√ß√£o de velha caso n√£o tenha quadrados dispon√≠veis

	  setTimeout(function(){
		if(document.getElementById("Mensagem").innerText.length == 0){
      var v = vazio();
	  document.getElementById("turno").innerText = "Sua vez";
      if (v.length == 0) {
      vitoria("ê§è", v);
	  
	  }
    }
	}, timeout + 100);

    }

    //Fun√ß√£o referente a intelig√™ncia de contra-ataques do computador

	function IA(vazio){

      //Se o computador come√ßar jogando

	  let jogada = 0;

      if(vazio.length  >= 8 && document.getElementById("Mensagem").innerText.length == 0){
      jogada = vazio[Math.floor(Math.random() * vazio.length)];
      board[jogada] = "ê§è";
	  console.log("rand");
	  }
      
      //contra-ataques

	  else if(vazio.length < 8 && document.getElementById("Mensagem").innerText.length == 0){

	  let vet = [[0, 4, 8], [2, 4, 6], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 1, 2], [3, 4, 5], [6, 7, 8], "fim"];	 
	  var v = [];

       for(var i = 0; i < 9; i++){

		if(v.length == 1){
	    board[v[0]] = "ê§è";
		console.log("contra");
		break;
	    }
		
		v = [];

		for(var j = 0; j < 3; j++){
		 if(board[vet[i][j]] == ""){
		    v.push(vet[i][j]);
		    }
		 
		 else if(vet[i][j] == "fim"){
			jogada = vazio[Math.floor(Math.random() * vazio.length)];
            board[jogada] = "ê§è";
			return;
		 }
	    }
        
		
	    
	 }

   }  
}

    //essa fun√ß√£o vai verificar se h√° uma vit√≥ria
      
    function vitoria(jogador, vazio){

      // verifica√ß√µes de vit√≥ria horizontais 
      
      if((board[0] == jogador && board[1] == jogador && board[2] 
      == jogador) || (board[3] == jogador && board[4] == jogador
      && board[5] == jogador) || (board[6] == jogador &&
	  board[7] == jogador && board[8] == jogador)){
       
      fimdejogo(jogador);
	  
       
      }
       
      // verifica√ß√µes de vit√≥ria verticais 
      else if((board[0] == jogador && board[3] == jogador &&
      board[6] == jogador) || (board[1] == jogador && board[4] 
      == jogador && board[7] == jogador) || (board[2] == jogador
      && board[5] == jogador && board[8] == jogador)){

      fimdejogo(jogador);
      
      }

      // verifica√ß√µes de vit√≥ria  diagonais
          
      else if((board[0] == jogador && board[4] == jogador && board[8] == jogador) 
      || (board[2] == jogador && board[4] == jogador && board[6] == jogador)){

		fimdejogo(jogador);
      }
      
      // verifica√ß√£o de velha

      if(vazio.length == 0 && document.getElementById("Mensagem").innerText.length == 0){

      document.getElementById("Mensagem").innerText = "Fim de Jogo - Deu Velha!";
	  document.getElementById("botao").style.display = "";
	  document.getElementById("turno").innerText = "";

      }

    }

    // Loga a mensagem de vit√≥ria ou derrota 
      
    function fimdejogo(j){

		document.getElementById("botao").style.display = "";
		document.getElementById("turno").innerText = "";

       if(j == "‚úï"){
         document.getElementById("Mensagem").innerText = "Fim de Jogo - Vit√≥ria";
     }

       else if(j == "ê§è"){
         document.getElementById("Mensagem").innerText = "Fim de Jogo - Derrota";
     } 
    }

    // fun√ß√£o de turno do usu√°rio
      
	function click(i){
      
        v = vazio();

		// Pega o valor do quadrado
		var square = board[i];

		// Verifica se o quadrado est√° vazio, se o turno √© do usu√°rio e se o jogo ja acabou
		if (square.length == 0 && userTurn && document.getElementById("Mensagem").innerText.length == 0) {
        
		// Atualiza o tabuleiro
		board[i] = "‚úï";
        
		updateBoard();
        
		// Turno do computador
		userTurn = false;
        vitoria("‚úï", v);

		computerTurn();
		             
			}
			vitoria("‚úï", v);
	}

		// Fun√ß√£o que inicia o jogo
      
		function startGame() {
      
		// Limpa o tabuleiro no JS e no HTML
      
		board = ["", "", "", "", "", "", "", "", ""];
        updateBoard();

        //limpa a mensagem de vit√≥ria ou derrota
      
        document.getElementById("Mensagem").innerText = "";
		

		//oculta o bot√£o de jogar novamente

		document.getElementById("botao").style.display = "none";

		if(Math.random() > 0.5){
			computerTurn();
		}

		else {
            document.getElementById("turno").innerText = "Sua vez";
            }
		}


		// Registra os eventos do jogo
		document.getElementById("quadrado0").onclick = function () { click(0) }
		document.getElementById("quadrado1").onclick = function () { click(1) }
		document.getElementById("quadrado2").onclick = function () { click(2) }
		document.getElementById("quadrado3").onclick = function () { click(3) }
		document.getElementById("quadrado4").onclick = function () { click(4) }
		document.getElementById("quadrado5").onclick = function () { click(5) }
		document.getElementById("quadrado6").onclick = function () { click(6) }
		document.getElementById("quadrado7").onclick = function () { click(7) }
		document.getElementById("quadrado8").onclick = function () { click(8) }

		// Inicia o jogo
		startGame();
      
		</script>
    
	</body>
</html>
